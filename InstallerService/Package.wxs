<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:util="http://wixtoolset.org">

	<Package Name="HardwareAgentService"
			 Manufacturer="Dallari"
			 Version="1.0.4"
			 UpgradeCode="550e8400-e29b-41d4-a716-446655440000"
			 Language="1049"
			 Codepage="1251">

		<MajorUpgrade DowngradeErrorMessage="Более новая версия уже установлена." />

		<MediaTemplate EmbedCab="yes" />

		<StandardDirectory Id="ProgramFiles64Folder">
			<Directory Id="CompanyFolder" Name="Dallari">
				<Directory Id="INSTALLFOLDER" Name="HardwareAgent" />
			</Directory>
		</StandardDirectory>

		<StandardDirectory Id="CommonAppDataFolder">
			<Directory Id="DallariDataFolder" Name="Dallari">
				<Directory Id="MyAppProgramDataFolder" Name="HardwareAgent" />
			</Directory>
		</StandardDirectory>

		<ComponentGroup Id="ServiceComponents" Directory="INSTALLFOLDER">
			<Component Id="Cmp_HardwareAgentExe" Guid="*">
				<File Id="File_Exe"
					  Source="C:\proj\davproj\ClientAPI\bin\Release\net10.0-windows10.0.17763.0\win-x64\publish\HardwareAgent.exe"
					  KeyPath="yes" />

				<ServiceInstall Id="ServiceInstaller"
								Type="ownProcess"
								Name="HardwareAgentService"
								DisplayName="Hardware Agent Service"
								Start="auto"
								Account="LocalSystem"
								ErrorControl="normal" />

				<ServiceControl Id="StartService"
								Name="HardwareAgentService"
								Start="install"
								Stop="both"
								Remove="uninstall"
								Wait="yes" />
			</Component>

			<Component Id="Cmp_AppSettingsJson" Guid="*">
				<File Id="File_Config"
					  Source="C:\proj\davproj\ClientAPI\bin\Release\net10.0-windows10.0.17763.0\win-x64\publish\appsettings.json"
					  KeyPath="yes" />
			</Component>
		</ComponentGroup>

		<ComponentGroup Id="AppDataComponents" Directory="MyAppProgramDataFolder">
			<Component Id="CreateAppDataFolder" Guid="d4e5f678-9012-3456-7890-abcdef123456">
				<CreateFolder />
				<RegistryValue Root="HKCU" Key="Software\Dallari\HardwareAgent" Name="installed" Type="integer" Value="1" KeyPath="yes" />
			</Component>
		</ComponentGroup>

		<Feature Id="MainFeature" Title="Hardware Agent Service" Level="1">
			<ComponentGroupRef Id="ServiceComponents" />
			<ComponentGroupRef Id="AppDataComponents" />
		</Feature>
	</Package>
</Wix>
