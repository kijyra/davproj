@{
    ViewData["Title"] = "Управление БД";
    ViewData["ActivePage"] = "Settings";
}
@section Styles{
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.6/css/dataTables.bootstrap5.min.css">

}

<h1>Управление Базой Данных</h1>
<ul class="nav nav-tabs mb-4" id="tableTabs" role="tablist">
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Инфраструктура</a>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" onclick="loadTable('Locations', this)">Локации</a></li>
            <li><a class="dropdown-item" onclick="loadTable('Buildings', this)">Здания</a></li>
            <li><a class="dropdown-item" onclick="loadTable('Floors', this)">Этажи</a></li>
            <li><a class="dropdown-item" onclick="loadTable('Offices', this)">Кабинеты</a></li>
        </ul>
    </li>
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Принтеры</a>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" onclick="loadTable('Manufactors', this)">Производители</a></li>
            <li><a class="dropdown-item" onclick="loadTable('Cartridges', this)">Картриджи</a></li>
            <li><a class="dropdown-item" onclick="loadTable('PrinterModels', this)">Модели принтеров</a></li>
            <li><a class="dropdown-item" onclick="loadTable('Printers', this)">Принтеры</a></li>
        </ul>
    </li>
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">Пользователи</a>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" onclick="loadTable('Users', this)">Пользователи</a></li>
            <li><a class="dropdown-item" onclick="loadTable('ADUsers', this)">Пользователи AD</a></li>
        </ul>
    </li>

    <li class="nav-item">
        <a class="nav-link" onclick="loadTable('PCs', this)">Компьютеры</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" onclick="loadTable('Phones', this)">Телефоны</a>
    </li>

    <li class="nav-item">
        <a class="nav-link" onclick="loadTable('Workplaces', this)">Рабочие места</a>
    </li>
</ul>


<div id="table-container">
    <p class="text-muted">Выберите таблицу для загрузки данных.</p>
</div>

@section Scripts {
    <script src="https://cdn.datatables.net/2.3.6/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.3.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
        function loadTable(tableName, element) {
            var targetElement = element || $('#tableTabs a[onclick*="' + tableName + '"]');
            $('#tableTabs .nav-link').removeClass('active');
            $('#tableTabs .dropdown-item').removeClass('active');
            if (targetElement) {
                $(targetElement).addClass('active');
                if ($(targetElement).hasClass('dropdown-item')) {
                    $(targetElement).closest('.dropdown').find('.dropdown-toggle').addClass('active');
                }
            }
            $('#table-container').html('<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Загрузка...</span></div>');
            $.ajax({
                url: '@Url.Action("GetTableData", "Admin")',
                type: 'GET',
                data: { tableName: tableName },
                success: function(result) {
                    $('#table-container').html(result);
                    $('#dynamicTable').DataTable({
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/2.3.6/i18n/ru.json"
                        },
                        "pageLength": 10,
                        "order": []
                    });
                },
                error: function(xhr, status, error) {
                    $('#table-container').html('<p class="text-danger">Ошибка при загрузке данных: ' + error + '</p>');
                }
            });
        }
        $(document).on('click', '.btn-open-modal', function(e) {
                   e.preventDefault();
                   var url = $(this).attr('href');
                   var myModal = new bootstrap.Modal(document.getElementById('modal-container'));
                   $('#modal-container .modal-body').html('<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Загрузка...</span></div>');
                   $('#modal-container .modal-body').load(url, function(response, status, xhr) {
                       if (status == "error") {
                           var msg = "Ошибка при загрузке страницы: ";
                           $('#modal-container .modal-body').html(msg + xhr.status + " " + xhr.statusText);
                       }
                   });
                   myModal.show();
               });
        $(document).ready(function () {
            loadTable('Workplaces');
        });
    </script>
}