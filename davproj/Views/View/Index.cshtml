@model IEnumerable<Workplace>
@{
    ViewData["Title"] = "Рабочие места";
    ViewData["ActivePage"] = "View";
    var buildings = ViewBag.Buildings as List<Building>;
    var selectedBuilding = ViewBag.SelectedBuilding as Building;
    var selectedFloor = ViewBag.SelectedFloor as Floor;
}
@section Styles {
    <style>
        body {
            background-color: var(--bs-body-bg);
            color: var(--bs-body-color);
        }
        .sidebar {
            background-color: var(--bs-secondary-bg);
            height: 100vh;
            padding: 20px;
            border-right: 1px solid var(--bs-border-color);
        }
        .content {
            padding: 20px;
        }
        .card {
            border: none;
            box-shadow: none;
            border-radius: 0;
        }
        .nav-pills .nav-link.active, .nav-pills .nav-link:hover {
            background-color: #007bff;
            color: white;
        }
        .dropdown-toggle-split::after {
            margin-left: 0.25em;
            vertical-align: 0.1em;
            content: "";
            border-top: .3em solid;
            border-right: .3em solid transparent;
            border-bottom: 0;
            border-left: .3em solid transparent;
        }
    </style>
}
<div class="container-fluid">
    <div class="row">
        <!-- Боковая панель навигации (Sidebar) - Только здания -->
        <div class="col-md-3 sidebar">
            <h4 class="mb-4">Здания</h4>
            <ul class="nav nav-pills flex-column mb-auto">
                @foreach (var b in buildings!)
                {
                    <li class="nav-item">
                        <a asp-action="Index" asp-route-buildingId="@b.Id"
                           class="nav-link @(selectedBuilding?.Id == b.Id ? "active" : "text-body-secondary")">
                            @b.Name
                        </a>
                    </li>
                }
            </ul>
        </div>
        <!-- Main Content -->
        <div class="col-md-9 content">
            @if (selectedBuilding != null)
            {
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1>Здание: @selectedBuilding.Name</h1>
                    <a class="btn btn-primary btn-open-modal"
                       role="button"
                       asp-area=""
                       asp-controller="View"
                       asp-action="WorkplaceAdd">
                        <i class="bi bi-plus-lg"></i> Добавить рабочее место
                    </a>
                </div>
                <!-- Вкладки этажей -->
                <ul class="nav nav-tabs mb-4">
                    @foreach (var floor in selectedBuilding!.Floors!)
                    {
                        <li class="nav-item">
                            <a class="nav-link @(selectedFloor?.Id == floor.Id ? "active" : "")"
                               asp-action="Index" asp-route-buildingId="@selectedBuilding.Id" asp-route-floorId="@floor.Id">
                                @floor.FloorNum
                            </a>
                        </li>
                    }
                </ul>
                @if (selectedFloor != null)
                {
                    <h3>Рабочие места на этаже "@selectedFloor!.FloorNum"</h3>
                    <p class="small text-body-secondary">Нажмите на рабочее место, чтобы увидеть детали</p>
                    @foreach (var office in selectedFloor!.Offices!)
                    {
                        @if (office.Workplaces != null && office.Workplaces.Any())
                        {
                            <div class="card shadow-sm border-0 mb-4 rounded-4 overflow-hidden bg-secondary-subtle">
                                <div class="card-header bg-body border-0 pt-3 px-3 pb-0">
                                    <div class="d-flex align-items-center">
                                        <div class="bg-primary bg-opacity-10 p-1 rounded-2 me-2">
                                            <i class="bi bi-building text-primary fs-6"></i>
                                        </div>
                                        <h6 class="mb-0 fw-semibold text-body">@(office.Name ?? "Офис")</h6>
                                        @if (office != null)
                                        {
                                            <a class="btn btn-xs btn-outline-warning border-0 p-0 btn-open-modal ms-2"
                                               asp-controller="Geo" asp-action="OfficeEdit" asp-route-id="@office.Id">
                                                <i class="bi bi-pencil-square"></i>
                                            </a>
                                        }
                                    </div>
                                </div>
                                <div class="accordion accordion-flush" id="accordion-office-@office.Id">
                                    @foreach (var wp in office.Workplaces)
                                    {
                                        <div class="accordion-item">
                                            <h2 class="accordion-header d-flex justify-content-between align-items-center pe-3">
                                                <button class="accordion-button collapsed text-body" type="button" data-bs-toggle="collapse" data-bs-target="#wp-@wp.Id">
                                                    <strong>@wp.Name</strong> &nbsp;
                                                    <span class="text-body-secondary">(@(wp.User?.FullName ?? "Свободно"))</span>
                                                </button>
                                                <a class="btn btn-xs btn-outline-warning border-0 p-0 btn-open-modal ms-2"
                                                   asp-controller="View" asp-action="WorkplaceEdit" asp-route-id="@wp.Id">
                                                    <i class="bi bi-pencil-square"></i>
                                                </a>
                                            </h2>
                                            <div id="wp-@wp.Id" 
                                                class="accordion-collapse collapse" 
                                                data-bs-parent="#accordion-office-@office.Id">
                                                <partial name="_WorkplaceDetails" model="wp" />
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    }
                }
            }
        </div>
    </div>
</div>